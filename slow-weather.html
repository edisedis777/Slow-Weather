<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Weather Landscape</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: #f0f0f0;
      }

      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
        position: relative;
      }

      .input-section {
        text-align: center;
        margin: 20px 0;
      }

      input {
        padding: 10px;
        font-size: 16px;
        width: 200px;
        margin-right: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      button {
        padding: 10px 20px;
        font-size: 16px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }

      button:hover {
        background: #45a049;
      }

      button:disabled {
        background: #cccccc;
        cursor: not-allowed;
      }

      .landscape {
        width: 100%;
        height: 600px;
        position: relative;
        overflow: hidden;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background: #87ceeb;
      }

      .sky {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        transition: background 1s;
        background: linear-gradient(to bottom, #87ceeb, #b6e3ff);
      }

      .sun {
        width: 80px;
        height: 80px;
        background: #ffd700;
        border-radius: 50%;
        position: absolute;
        right: 50px;
        top: 50px;
        box-shadow: 0 0 50px #ffd700;
        transition: all 1s;
        animation: glow 2s infinite alternate;
      }

      @keyframes glow {
        from {
          box-shadow: 0 0 30px #ffd700;
        }
        to {
          box-shadow: 0 0 60px #ffd700;
        }
      }

      .cloud {
        background: white;
        border-radius: 20px;
        position: absolute;
        opacity: 0.9;
        animation: float 30s linear infinite;
        z-index: 1;
      }

      @keyframes float {
        from {
          transform: translateX(-150px);
        }
        to {
          transform: translateX(1350px);
        }
      }

      .terrain {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 40%;
        z-index: 2;
      }

      .terrain-path {
        fill: url(#terrainGradient);
        transition: d 1s ease-in-out;
      }

      .time-axis-bg {
        fill: rgba(0, 0, 0, 0.7);
      }

      .time-label {
        font-size: 16px; /* Increased from 12px */
        fill: white;
        text-anchor: middle;
        font-family: Arial, sans-serif;
      }

      .temperature-label {
        position: absolute;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 3;
        transition: all 0.5s;
      }

      .weather-info {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 20px;
        border-radius: 10px;
        font-size: 14px;
        line-height: 1.6;
        z-index: 10;
        backdrop-filter: blur(5px);
      }

      .rain {
        position: absolute;
        width: 2px;
        background: rgba(255, 255, 255, 0.6);
        animation: rain 1s linear infinite;
        z-index: 1;
      }

      @keyframes rain {
        from {
          transform: translateY(-20px);
        }
        to {
          transform: translateY(620px);
        }
      }

      .snow {
        position: absolute;
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
        animation: snow 3s linear infinite;
        z-index: 1;
      }

      @keyframes snow {
        from {
          transform: translateY(-20px);
        }
        to {
          transform: translateY(620px);
        }
      }

      .leaf {
        position: absolute;
        z-index: 4;
        width: 40px;
        height: 50px;
      }

      .leaf-svg {
        transition: transform 0.5s;
      }

      @keyframes sway {
        0%,
        100% {
          transform: rotate(-10deg);
        }
        50% {
          transform: rotate(10deg);
        }
      }

      .toggle-button {
        position: absolute;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 16px;
        font-size: 14px;
        background: #2196f3;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
        z-index: 20;
      }

      .toggle-button:hover {
        background: #1976d2;
      }

      .error-message {
        color: #ff0000;
        text-align: center;
        margin-top: 10px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="input-section">
        <input type="text" id="cityInput" placeholder="Enter city name" />
        <button onclick="getWeather()" id="searchButton">Show Weather</button>
        <div class="error-message" id="errorMessage"></div>
      </div>
      <div class="landscape">
        <div class="sky"></div>
        <div class="sun"></div>
        <svg class="terrain" preserveAspectRatio="none" viewBox="0 0 1000 400">
          <defs>
            <linearGradient
              id="terrainGradient"
              x1="0%"
              y1="0%"
              x2="0%"
              y2="100%">
              <stop
                offset="0%"
                class="terrain-top"
                style="stop-color: #4caf50" />
              <stop
                offset="100%"
                class="terrain-bottom"
                style="stop-color: #2e7d32" />
            </linearGradient>
          </defs>
          <path
            class="terrain-path"
            d="M0 400 L0 300 Q 500 200 1000 300 L1000 400 Z" />
          <rect
            class="time-axis-bg"
            x="0"
            y="370"
            width="1000"
            height="30"
            rx="5"
            ry="5" />
          <text class="time-label" x="0" y="390">00:00</text>
          <text class="time-label" x="250" y="390">06:00</text>
          <text class="time-label" x="500" y="390">12:00</text>
          <text class="time-label" x="750" y="390">18:00</text>
          <text class="time-label" x="1000" y="390">24:00</text>
        </svg>
        <div class="weather-info"></div>
        <svg class="leaf" style="left: 75%">
          <path
            class="leaf-svg"
            d="M10 30 Q15 20 20 10 Q25 20 30 30 Q35 40 20 50 Q5 40 10 30 Z"
            fill="#228b22" />
        </svg>
        <button class="toggle-button" onclick="toggleTemperature()">
          Toggle °C/°F
        </button>
      </div>
    </div>

    <script>
      const GEOCODING_API = "https://geocoding-api.open-meteo.com/v1/search";
      const WEATHER_API = "https://api.open-meteo.com/v1/forecast";
      let isCelsius = true;
      let currentWeatherData = null;

      const FALLBACK_WEATHER = {
        current: {
          temperature_2m: 20,
          relative_humidity_2m: 50,
          precipitation: 0,
          cloud_cover: 20,
          pressure_msl: 1013,
          wind_speed_10m: 5,
          wind_direction_10m: 90,
          is_day: 1,
        },
        hourly: {
          temperature_2m: Array(24).fill(20),
        },
      };

      async function getWeather() {
        const cityName = document.getElementById("cityInput").value.trim();
        const errorMessage = document.getElementById("errorMessage");
        const searchButton = document.getElementById("searchButton");

        if (!cityName) {
          showError("Please enter a city name");
          return;
        }

        searchButton.disabled = true;
        errorMessage.style.display = "none";

        try {
          const geoResponse = await fetch(
            `${GEOCODING_API}?name=${encodeURIComponent(
              cityName
            )}&count=1&language=en&format=json`
          );
          const geoData = await geoResponse.json();

          if (!geoData.results || geoData.results.length === 0) {
            showError("City not found!");
            return;
          }

          const { latitude, longitude } = geoData.results[0];
          const weatherResponse = await fetch(
            `${WEATHER_API}?latitude=${latitude}&longitude=${longitude}` +
              `&current=temperature_2m,relative_humidity_2m,precipitation,cloud_cover,pressure_msl,wind_speed_10m,wind_direction_10m,is_day` +
              `&hourly=temperature_2m&forecast_days=1`
          );
          const weatherData = await weatherResponse.json();

          if (!weatherData.current || !weatherData.hourly) {
            throw new Error("Incomplete weather data received");
          }

          currentWeatherData = weatherData;
          updateLandscape(weatherData);
        } catch (error) {
          console.error("Error:", error);
          showError("Using fallback data due to error!");
          currentWeatherData = FALLBACK_WEATHER;
          updateLandscape(FALLBACK_WEATHER);
        } finally {
          searchButton.disabled = false;
        }
      }

      function showError(message) {
        const errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
      }

      function celsiusToFahrenheit(celsius) {
        return (celsius * 9) / 5 + 32;
      }

      function updateTerrainPath(temperatures) {
        const svg = document.querySelector(".terrain");
        const path = svg.querySelector(".terrain-path");
        const topStop = svg.querySelector(".terrain-top");
        const bottomStop = svg.querySelector(".terrain-bottom");
        const width = 1000;
        const height = 400;

        const points = temperatures.map((temp, i) => {
          const x = (i / (temperatures.length - 1)) * width;
          const y = height - (((temp + 20) / 60) * height * 0.6 + height * 0.2);
          return `${x} ${y}`;
        });

        const pathData = `M0 ${height} L${points.join(
          " L"
        )} L${width} ${height} Z`;
        path.setAttribute("d", pathData);

        const avgTempCelsius =
          temperatures.reduce((a, b) => a + b) / temperatures.length;
        if (avgTempCelsius < 0) {
          topStop.style.stopColor = "#ffffff";
          bottomStop.style.stopColor = "#d3d3d3";
        } else {
          topStop.style.stopColor = "#4caf50";
          bottomStop.style.stopColor = "#2e7d32";
        }

        document
          .querySelectorAll(".temperature-label")
          .forEach((label) => label.remove());
        temperatures.forEach((temp, i) => {
          if (i % 6 === 0) {
            const displayTemp = isCelsius ? temp : celsiusToFahrenheit(temp);
            const label = document.createElement("div");
            label.className = "temperature-label";
            label.textContent = `${Math.round(displayTemp)}°${
              isCelsius ? "C" : "F"
            }`;
            label.style.left = `${(i / (temperatures.length - 1)) * 100}%`;
            label.style.bottom = `${((temp + 20) / 60) * 40 + 10}%`;
            document.querySelector(".landscape").appendChild(label);
          }
        });

        const leaf = document.querySelector(".leaf");
        const terrainIndex = Math.round(0.75 * (temperatures.length - 1));
        const terrainHeight = height - points[terrainIndex].split(" ")[1];
        const labelHeightOffset = 60;
        leaf.style.bottom = `${terrainHeight + labelHeightOffset}px`;
      }

      function updateLandscape(weather) {
        const adjustedTemp = isCelsius
          ? weather.current.temperature_2m
          : celsiusToFahrenheit(weather.current.temperature_2m);

        const weatherInfo = document.querySelector(".weather-info");
        weatherInfo.innerHTML = `
          <div>Temperature: ${adjustedTemp.toFixed(1)}°${
          isCelsius ? "C" : "F"
        }</div>
          <div>Humidity: ${weather.current.relative_humidity_2m}%</div>
          <div>Wind: ${weather.current.wind_speed_10m} m/s</div>
          <div>Clouds: ${weather.current.cloud_cover}%</div>
          <div>Pressure: ${weather.current.pressure_msl} hPa</div>
          <div>Precipitation: ${weather.current.precipitation} mm</div>
        `;

        updateTerrainPath(weather.hourly.temperature_2m);

        const sky = document.querySelector(".sky");
        const cloudiness = weather.current.cloud_cover;
        const isDay = weather.current.is_day;

        if (isDay) {
          sky.style.background = `linear-gradient(to bottom, 
            rgba(135,206,235,${1 - cloudiness / 150}), 
            rgba(182,227,255,${1 - cloudiness / 150}))`;
        } else {
          sky.style.background = `linear-gradient(to bottom, 
            rgba(25,25,112,${1 - cloudiness / 150}), 
            rgba(65,105,225,${1 - cloudiness / 150}))`;
        }

        const sun = document.querySelector(".sun");
        if (isDay) {
          sun.style.background = "#FFD700";
          sun.style.opacity = 1 - cloudiness / 150;
        } else {
          sun.style.background = "#FFFFFF";
          sun.style.opacity = 0.8 - cloudiness / 150;
        }

        const windSpeed = weather.current.wind_speed_10m;
        const swayDuration = Math.max(1, 4 - windSpeed * 0.15);
        document.querySelectorAll(".leaf-svg").forEach((leaf) => {
          leaf.style.animation = `sway ${swayDuration}s infinite ease-in-out`;
        });

        document
          .querySelectorAll(".cloud, .rain, .snow")
          .forEach((el) => el.remove());

        if (cloudiness > 0) {
          addClouds(cloudiness);
        }

        const currentTempCelsius = weather.current.temperature_2m;
        if (weather.current.precipitation > 0) {
          if (currentTempCelsius < 0) {
            addSnow(weather.current.precipitation);
          } else {
            addRain(weather.current.precipitation);
          }
        }
      }

      function addClouds(cloudiness) {
        const numClouds = Math.ceil(cloudiness / 20);
        for (let i = 0; i < numClouds; i++) {
          const cloud = document.createElement("div");
          cloud.className = "cloud";
          cloud.style.width = Math.random() * 100 + 100 + "px";
          cloud.style.height = Math.random() * 40 + 40 + "px";
          cloud.style.top = Math.random() * 200 + "px";
          cloud.style.animationDelay = Math.random() * 20 + "s";
          document.querySelector(".landscape").appendChild(cloud);
        }
      }

      function addRain(precipitation) {
        const raindrops = Math.min(Math.ceil(precipitation * 20), 200);
        for (let i = 0; i < raindrops; i++) {
          const rain = document.createElement("div");
          rain.className = "rain";
          rain.style.left = Math.random() * 100 + "%";
          rain.style.height = Math.random() * 20 + 10 + "px";
          rain.style.animationDelay = Math.random() * 2 + "s";
          document.querySelector(".landscape").appendChild(rain);
        }
      }

      function addSnow(precipitation) {
        const snowflakes = Math.min(Math.ceil(precipitation * 40), 200);
        for (let i = 0; i < snowflakes; i++) {
          const snow = document.createElement("div");
          snow.className = "snow";
          snow.style.left = Math.random() * 100 + "%";
          snow.style.animationDelay = Math.random() * 3 + "s";
          document.querySelector(".landscape").appendChild(snow);
        }
      }

      function toggleTemperature() {
        isCelsius = !isCelsius;
        if (currentWeatherData) {
          const weatherInfo = document.querySelector(".weather-info");
          const adjustedTemp = isCelsius
            ? currentWeatherData.current.temperature_2m
            : celsiusToFahrenheit(currentWeatherData.current.temperature_2m);
          weatherInfo.innerHTML = `
            <div>Temperature: ${adjustedTemp.toFixed(1)}°${
            isCelsius ? "C" : "F"
          }</div>
            <div>Humidity: ${
              currentWeatherData.current.relative_humidity_2m
            }%</div>
            <div>Wind: ${currentWeatherData.current.wind_speed_10m} m/s</div>
            <div>Clouds: ${currentWeatherData.current.cloud_cover}%</div>
            <div>Pressure: ${currentWeatherData.current.pressure_msl} hPa</div>
            <div>Precipitation: ${
              currentWeatherData.current.precipitation
            } mm</div>
          `;

          document
            .querySelectorAll(".temperature-label")
            .forEach((label) => label.remove());
          currentWeatherData.hourly.temperature_2m.forEach((temp, i) => {
            if (i % 6 === 0) {
              const displayTemp = isCelsius ? temp : celsiusToFahrenheit(temp);
              const label = document.createElement("div");
              label.className = "temperature-label";
              label.textContent = `${Math.round(displayTemp)}°${
                isCelsius ? "C" : "F"
              }`;
              label.style.left = `${
                (i / (currentWeatherData.hourly.temperature_2m.length - 1)) *
                100
              }%`;
              label.style.bottom = `${((temp + 20) / 60) * 40 + 10}%`;
              document.querySelector(".landscape").appendChild(label);
            }
          });
        }
      }

      document
        .getElementById("cityInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            getWeather();
          }
        });
    </script>
  </body>
</html>
